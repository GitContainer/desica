---
title: "desica - a model for the desiccation dynamics of plants"
author: "Remko"
date: "23 June 2017"
output:
  html_document: 
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Hydraulics of the soil-to-leaf pathway

Total plant conductance (for a well hydrated plan) is given as an input (in the usual leaf area specific hydraulic conductance), $k_L(0)$, and depends on stem water potential ($\Psi_x$) via the Weibull equation (see @duursma2017).




$$k_L(\Psi_x) = k_L(0) \cdot (1 - x/100)^p$$
$$p = (\Psi_x/P_x)^{(P_xS_x)/V}$$
$$V = (x-100)log(1-x/100)$$

The 'percent loss conductance' is calculated as,

$$PLC = 100 \cdot (1 - k_L(\Psi_x)/k_L(0))$$

We use the PLC to determine whether the plant is dead or not.


The usual Gardner one-root model (details to be added) is used to calculate the soil conductance.

$$k_S = f(\Psi_S)$$


We have soil to root surface ('soil conductance'), root surface to stem water storage (which is assumed to be halfway to the leaves), and stem water storage to leaves.  

Then we have the conductance from soil to stem water pool (since the conductances are in series):

$$k_{rst} = 1 / (1/k_S + 1/(2 \cdot k_L))$$


and the conductance from the stem water pool to the leaves (since we assumed the water pool is halfway up the stem),

$$k_{stl} = 2 \cdot k_L$$





# Leaf gas exchange

We use a modified Tuzet model of stomatal conductance, which is given by:

$$g_s = g_0 + g_1 \cdot \frac{A_n}{C_a} \cdot f(\Psi_L) $$

Net photosynthesis (A~n~) and g~s~ are calculated by coupling this equation to the Farquhar model, and the diffusion constraint, as usual [@duursma2015].

But here we set g~0~ to zero, and instead use a minimum function:

$$g_s = \min(g_s, g_{min})$$
where g~min~ is the minimum leaf conductance (the conductance of a detached leaf).

The water potential function ($f(\Psi_L)$) is a sigmoid:


$$f(\Psi_L) = (1 + e^{s_f \Psi_v}) / (1 + e^{s_f (\Psi_v - \Psi_L)})$$

The response of g~s~ to leaf water potential is illustrated in Fig. 1.


```{r, echo=FALSE, fig.width=5, fig.height=4}
library(plantecophys)

fsig_tuzet <- function(psil, psiv, sf){
  (1 + exp(sf*psiv)) / (1 + exp(sf*(psiv - psil)))
}

pars <- list(g1 = 10,
             Ca = 400,
             psiv = -2.5,
             sf = 6,
             gmin = 30 / 1000)

psils <- seq(-5, 0, length=501)

p <- Photosyn(VPD=2, 
              gsmodel="BBdefine", 
              g0=0.001,
              BBmult=(pars$g1/pars$Ca)*fsig_tuzet(psils, pars$psiv, pars$sf), 
              Tleaf=25,
              PPFD=2000,
              Ca=pars$Ca)

# Don't add gmin, instead use it as bottom value.
gs <- pmax(pars$gmin, p$GS)

plot(psils, gs, type='l', ylim=c(0,0.35))
lines(psils, p$GS, lty=5)

```

*Figure 1*. Assumed response of stomatal conductance to leaf water potential. Solid line is simulated with g~min~ = 30 mmol m^-2^ s^-1^ (a high value for illustration purpose only), dashed line with g~min~ = 0. Thus the minimum conductance is not added to the simulated g~s~, but assumed as the lower limit. Parameter $\Psi_v$ is the water potential (MPa) at which g~s~ is 50% of its maximum (here, -2.5 MPa), and s~f~ is the slope of the curve at the inflection point. 


# Fluxes

We do not assume steady-state of the water flux, instead it is solved numerically every timestep by taking into account the capacitance of the stem water pool (C~s~) and the leaf water pool (C~l~). Because there is no steady state, we have to solve two fluxes: the flux of water from stem to leaves (J~sl~), and the flux of water from soil to the stem (J~rs~). 

To greatly simplify the solution, we use $\Psi_L$ and $\Psi_{st}$ from the previous timestep to find J~sl~ and J~rs~. With $\Psi_L$, we can also calculate the transpiration rate (the flux of water from leaves to the atmosphere), E~L~. In this simple version of the model, no leaf-to-canopy scaling is done, so total plant transpiration is simply $E_t = E_L \cdot A_L$, where A~L~ is plant leaf area (m^2^).

Now we can write the dynamic equation for the change in leaf water potential per unit time, as a function of the net flux (J~sl~ is water transported into the leaf pool, E~t~ water evaporating from the leaf pool, both in units of mol t^-1^), and the capacitance (mol MPa^-1^).

$$\frac{d\Psi_{l}}{dt} = \frac{J_{sl} - E_t}{C_l}$$

A similar equation can be written for the flux into and out of the stem pool:

$$\frac{d\Psi_{st}}{dt} = \frac{J_{rs} - J_{sl}}{C_s}$$







$$J_{rs} = A_L k_S (\Psi_S - \Psi_{st})$$

$$J_{sl} = A_L k_P (\Psi_{st} - \Psi_L)$$


$$C_s = c_s V_s (1 - \rho_w/\rho_s)$$ 

$$C_l = c_l A_L f(LMA?)$$ 










| Parameter |  Definition         | Units     |
|-----------|-------------------- | --------- |
| J~rs~     | Root to stem flow   | mol s^-1^   |
| J~sl~     | Stem to leaf flow   | mol s^-1^   |
| E~t~      | Transpiration       | mol s^-1^   |
| c~s~      | Specific stem capacitance | RWC MPa^-1^ |
| C~s~      | Absolute stem capacitance | mol MPa^-1^ |
| c~l~      | Specific leaf capacitance | RWC MPa^-1^ |
| C~l~      | Absolute leaf capacitance | mol MPa^-1^ |
| k~S~      | soil to root hydr. conductance  | mol m^-2^ s^-1^ MPa^-1^ |
| k~P~      | plant hydr. conductance | mol m^-2^ s^-1^ MPa^-1^ |
| A~L~      | Plant leaf area | m^2^ |
| g~min~    | Minimum conductance | mol m-2 s-1
|  $\Psi_{st}$ | stem water potential | MPa |
|  $\Psi_{S}$ | soil water potential | MPa |
|  $\Psi_{L}$ | leaf water potential | MPa |
| $\Psi_{min}$ | Minimum leaf water potential (turgor loss point) | MPa |
| $\rho_w$   | wood density | kg m^-3^ |
| $\rho_s$   | non-lumen wood density (constant) | kg m^-3^ |
| V~s~       | sapwood volume | m^3^ |


